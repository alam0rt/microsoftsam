# Sauron Configuration for Mumble Voice Bot

soul: "raf"

llm:
  endpoint: "https://openrouter.ai/api/v1/chat/completions"
  model: "openai/gpt-oss-20b:free"
  # api_key loaded from OPENROUTER_API_KEY env var
  timeout: 8.0
  max_tokens: 400  # Need extra for model reasoning tokens (gpt-oss uses ~100 reasoning + response)
  temperature: 0.7
  top_p: 0.9
  frequency_penalty: 0.3  # Reduce repetition
  presence_penalty: 0.2   # Encourage topic variety
  context_messages: 16

tts:
  num_steps: 4
  device: "cuda"  # GPU - CPU is too slow

mumble:
  host: "murmur.middleearth.samlockart.com"
  port: 64738

stt:
  provider: "nemotron_nemo"
  # Nemotron settings
  nemotron_model: "nvidia/nemotron-speech-streaming-en-0.6b"
  nemotron_chunk_ms: 160
  nemotron_device: "cuda"  # GPU for fast ASR response
  # Wyoming settings
  # wyoming_host: "localhost"
  # wyoming_port: 10300

bot:
  asr_threshold: 2000
  conversation_timeout: 300
  max_response_staleness: 15.0  # Skip responses older than this (seconds)
  barge_in_enabled: false  # Bot talks over everyone without interruption

  # Speech filtering (Better Speech Plan)
  echo_filter_enabled: true       # Prevent bot from responding to its own speech
  echo_filter_decay: 30.0         # How long to remember bot outputs (seconds)
  utterance_filter_enabled: true  # Filter out non-meaningful utterances
  utterance_min_words: 1
  utterance_min_chars: 3
  turn_prediction_enabled: true   # Adaptive response delays
  turn_prediction_base_delay: 0.3
  turn_prediction_max_delay: 2.0
  turn_prediction_threshold: 0.7
  state_machine_enabled: true     # Turn management state machine
  state_machine_cooldown: 0.5
  preserve_context_on_switch: true  # Keep conversation when switching souls
  max_preserved_messages: 10

# Tools work with LFM2.5 via text-based format (not OpenAI-style API parameter)
# The bot auto-detects and uses the appropriate format for each model
tools:
  enabled: true
  sound_effects_enabled: true
  sound_effects_dir: "/srv/share/sam/projects/microsoftsam/sounds"
  sound_effects_web_search: true  # Search MyInstants.com for sounds
  sound_effects_verify_ssl: false  # Disable SSL verification (cert issues on server)

# Model storage paths
models:
  hf_home: "/srv/share/public/models"
